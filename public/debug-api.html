<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced API Debug Console - Pardis Client</title>
    <link rel="icon" href="/fav.png" type="image/png" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
      :root {
        --primary: #4f46e5;
        --primary-dark: #3730a3;
        --secondary: #7c3aed;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --info: #3b82f6;
        --dark: #1f2937;
        --light: #f8fafc;
        --border: #e5e7eb;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        --radius: 12px;
        --radius-lg: 20px;
        --muted: #9ca3af;
        --bg: #fafbfc;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: var(--dark);
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        color: white;
        padding: 40px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
      }

      .header-content {
        position: relative;
        z-index: 1;
      }

      .header h1 {
        font-size: 2.4rem;
        margin-bottom: 10px;
        font-weight: 800;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        opacity: 0.95;
        font-size: 1.1rem;
        font-weight: 300;
      }

      .status-bar {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        flex-wrap: wrap;
        gap: 12px;
      }

      .status-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-size: 0.95rem;
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--success);
        animation: pulse 2s infinite;
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
      }

      @keyframes pulse {
        0% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
        }
        70% {
          transform: scale(1);
          box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
        }
        100% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
        }
      }

      .content {
        padding: 40px;
        background: var(--bg);
      }

      .tabs {
        display: flex;
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 30px;
        overflow: hidden;
        position: sticky;
        top: 10px;
        z-index: 5;
      }

      .tab {
        flex: 1;
        padding: 14px 16px;
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 0.98rem;
        font-weight: 700;
        color: #6b7280;
        transition: all 0.3s ease;
        position: relative;
      }

      .tab.active {
        color: var(--primary);
        background: #f8fafc;
      }

      .tab.active::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .section {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 30px;
        overflow: hidden;
      }

      .section-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .section-title {
        font-size: 1.25rem;
        font-weight: 800;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-body {
        padding: 24px;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 18px;
        margin-bottom: 20px;
      }

      .metric-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
        transition: all 0.25s ease;
        position: relative;
        overflow: hidden;
      }

      .metric-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
      }

      .metric-card:hover {
        border-color: var(--primary);
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
      }

      .metric-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
      }

      .metric-icon {
        width: 42px;
        height: 42px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      .metric-title {
        font-size: 1.02rem;
        font-weight: 700;
        color: var(--dark);
      }

      .metric-value {
        font-size: 1.9rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 6px;
      }

      .metric-description {
        color: #6b7280;
        font-size: 0.9rem;
      }

      .actions-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        padding: 10px 16px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 0.92rem;
        font-weight: 700;
        transition: all 0.25s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        box-shadow: none;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success), #059669);
        color: white;
      }

      .btn-warning {
        background: linear-gradient(135deg, var(--warning), #d97706);
        color: white;
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--error), #dc2626);
        color: white;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #6b7280, #4b5563);
        color: white;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 16px;
        background: #eef2ff;
        color: var(--primary);
        font-weight: 700;
        font-size: 0.85rem;
      }

      .badge {
        padding: 4px 8px;
        border-radius: 10px;
        font-weight: 700;
        font-size: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .badge.success {
        background: #dcfce7;
        color: #166534;
      }

      .badge.error {
        background: #fee2e2;
        color: #991b1b;
      }

      .badge.warning {
        background: #fef3c7;
        color: #92400e;
      }

      .badge.info {
        background: #e0f2fe;
        color: #075985;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        border-bottom: 1px solid var(--border);
        padding: 10px 8px;
        text-align: right;
        font-size: 0.9rem;
      }

      th {
        background: #f8fafc;
        font-weight: 800;
        color: #1f2937;
        cursor: pointer;
        user-select: none;
      }

      tr:hover td {
        background: #f9fafb;
      }

      .input,
      select,
      textarea {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: #fff;
        width: 100%;
        font-size: 0.95rem;
      }

      .filters {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
        margin-bottom: 16px;
      }

      .console {
        background: #111827;
        border-radius: var(--radius);
        padding: 18px;
        font-family: "Courier New", monospace;
        font-size: 0.92rem;
        color: #e5e7eb;
        max-height: 420px;
        overflow-y: auto;
        position: relative;
      }

      .console-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .console-controls {
        display: flex;
        gap: 8px;
      }

      .console-btn {
        background: #1f2937;
        border: 1px solid #374151;
        color: #9ca3af;
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .console-btn:hover {
        background: #374151;
        color: white;
      }

      .log-entry {
        display: grid;
        grid-template-columns: 140px 90px 1fr 120px;
        gap: 8px;
        align-items: center;
        padding: 10px 8px;
        border-radius: 10px;
        border: 1px solid #1f2937;
        margin-bottom: 8px;
        background: #0b1220;
      }

      .log-entry .message {
        word-break: break-word;
      }

      .log-level {
        padding: 4px 10px;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: 800;
        width: fit-content;
      }

      .log-level.debug {
        background: #e5e7eb;
        color: #111827;
      }

      .log-level.info {
        background: #e0f2fe;
        color: #075985;
      }

      .log-level.success {
        background: #dcfce7;
        color: #166534;
      }

      .log-level.warn {
        background: #fef3c7;
        color: #92400e;
      }

      .log-level.error {
        background: #fee2e2;
        color: #991b1b;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border-radius: 10px;
        background: #eef2ff;
        color: #312e81;
        font-weight: 700;
        font-size: 0.8rem;
      }

      .toast-container {
        position: fixed;
        left: 20px;
        bottom: 20px;
        display: grid;
        gap: 8px;
        z-index: 20;
      }

      .toast {
        background: #111827;
        color: white;
        padding: 12px 14px;
        border-radius: 12px;
        min-width: 260px;
        box-shadow: var(--shadow-lg);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .toast.success {
        border-right: 4px solid var(--success);
      }

      .toast.error {
        border-right: 4px solid var(--error);
      }

      .toast.info {
        border-right: 4px solid var(--info);
      }

      .drawer {
        background: #f9fafb;
        padding: 16px;
        border-radius: 12px;
        border: 1px solid var(--border);
      }

      .label {
        font-size: 0.85rem;
        color: #6b7280;
        margin-bottom: 4px;
      }

      .value {
        font-weight: 800;
        color: #111827;
      }

      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 30;
      }

      .modal {
        background: white;
        padding: 24px;
        border-radius: 16px;
        width: min(700px, 95vw);
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
      }

      .empty-state {
        padding: 20px;
        border: 1px dashed var(--border);
        border-radius: 12px;
        text-align: center;
        color: #6b7280;
      }

      .loader {
        width: 18px;
        height: 18px;
        border: 3px solid #f3f4f6;
        border-top: 3px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .container {
          margin: 8px;
          border-radius: var(--radius);
        }

        .header {
          padding: 28px 18px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .content {
          padding: 18px;
        }

        .tabs {
          flex-direction: column;
          position: static;
        }

        .log-entry {
          grid-template-columns: 120px 80px 1fr;
          grid-template-areas: "time level select" "message message message";
          gap: 6px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="header-content">
          <h1>ğŸš€ Ú©Ù†Ø³ÙˆÙ„ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ù¾Ø§ÛŒØ´ Ùˆ Ø¯ÛŒØ¨Ø§Ú¯ API</h1>
          <p>Ù¾Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡ØŒ Ù„Ø§Ú¯ Ø³Ø§Ø®Øªâ€ŒÛŒØ§ÙØªÙ‡ØŒ Ùˆ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø§ÛŒÙ…Ù† Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ· Production</p>
        </div>
      </div>

      <div class="status-bar" aria-live="polite">
        <div class="status-item">
          <span class="status-dot" id="status-dot"></span>
          <span
            >ÙˆØ¶Ø¹ÛŒØª API: <strong id="api-status">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</strong></span
          >
        </div>
        <div class="status-item">
          <span
            >Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: <strong id="last-update">--:--:--</strong></span
          >
        </div>
        <div class="status-item">
          <span>Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®: <strong id="response-time">-- ms</strong></span>
        </div>
        <div class="status-item">
          <span>ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§: <strong id="request-count">0</strong></span>
        </div>
        <div class="status-item">
          <span class="badge info" id="privacy-badge">Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ ÙØ¹Ø§Ù„</span>
        </div>
        <div class="status-item">
          <button class="btn btn-secondary" id="open-settings">
            âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
          </button>
        </div>
      </div>

      <div class="content">
        <div class="tabs" role="tablist">
          <button class="tab active" data-tab="overview">ğŸ“Š Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ</button>
          <button class="tab" data-tab="network">ğŸŒ Ø´Ø¨Ú©Ù‡</button>
          <button class="tab" data-tab="logs">ğŸ“ Ù„Ø§Ú¯â€ŒÙ‡Ø§</button>
          <button class="tab" data-tab="cache">ğŸ§¹ Ú©Ø´</button>
          <button class="tab" data-tab="diagnostics">ğŸ©º Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ</button>
        </div>

        <div id="overview" class="tab-content active">
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-header">
                <div
                  class="metric-icon"
                  style="background: #dcfce7; color: #166534"
                >
                  ğŸ“Š
                </div>
                <div>
                  <div class="metric-title">Ø³Ù„Ø§Ù…Øª API</div>
                  <div class="metric-description">Ø§Ù…ØªÛŒØ§Ø² Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø³Ù„Ø§Ù…Øª</div>
                </div>
              </div>
              <div class="metric-value" id="health-score">--</div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <div
                  class="metric-icon"
                  style="background: #dbeafe; color: #1e40af"
                >
                  âš¡
                </div>
                <div>
                  <div class="metric-title">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾Ø§Ø³Ø®</div>
                  <div class="metric-description">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø®ÛŒØ±</div>
                </div>
              </div>
              <div class="metric-value" id="avg-response">-- ms</div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <div
                  class="metric-icon"
                  style="background: #fef3c7; color: #92400e"
                >
                  ğŸ“¦
                </div>
                <div>
                  <div class="metric-title">Ø­Ø¬Ù… Ú©Ø´</div>
                  <div class="metric-description">
                    local/session + cache API
                  </div>
                </div>
              </div>
              <div class="metric-value" id="cache-size-display">-- KB</div>
            </div>

            <div class="metric-card">
              <div class="metric-header">
                <div
                  class="metric-icon"
                  style="background: #f3e8ff; color: #7c3aed"
                >
                  ğŸ”„
                </div>
                <div>
                  <div class="metric-title">Ù†Ø³Ø®Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡</div>
                  <div class="metric-description">Ø¢Ø®Ø±ÛŒÙ† build</div>
                </div>
              </div>
              <div class="metric-value" id="app-version-display">
                VERSION_PLACEHOLDER
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <div class="section-title">ğŸ¯ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹</div>
              <div class="actions-row">
                <div class="pill">Ù…Ø­ÛŒØ·: ENVIRONMENT_PLACEHOLDER</div>
                <div class="pill">API: API_URL_PLACEHOLDER</div>
              </div>
            </div>
            <div class="section-body actions-row">
              <button class="btn btn-primary" id="action-health">
                <span class="loader" id="health-loading" hidden></span> ğŸ¥ Ø¨Ø±Ø±Ø³ÛŒ
                Ø³Ù„Ø§Ù…Øª
              </button>
              <button class="btn btn-success" id="action-test-all">
                <span class="loader" id="test-loading" hidden></span> ğŸ§ª ØªØ³Øª Ù‡Ù…Ù‡
                API Ù‡Ø§
              </button>
              <button class="btn btn-warning" id="action-pause-health">
                â¸ï¸ ØªÙˆÙ‚Ù Ù¾Ø§ÛŒØ´
              </button>
              <button class="btn btn-secondary" id="action-export-bundle">
                ğŸ“¦ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ø³ØªÙ‡ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ
              </button>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <div class="section-title">ğŸ“ˆ Ø±ÙˆÙ†Ø¯ ØªØ§Ø®ÛŒØ± Ùˆ Ø®Ø·Ø§</div>
              <div class="badge info" id="request-rate">-- req/min</div>
            </div>
            <div class="section-body">
              <div
                style="
                  display: grid;
                  grid-template-columns: 2fr 1fr;
                  gap: 16px;
                  flex-wrap: wrap;
                "
              >
                <canvas id="latency-chart" height="180"></canvas>
                <canvas id="status-chart" height="180"></canvas>
              </div>
              <div style="margin-top: 16px">
                <canvas id="rpm-chart" height="150"></canvas>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <div class="section-title">ğŸ”— Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ùˆ Endpoint Ù‡Ø§</div>
              <div class="badge success">Ù„ÛŒØ³Øª Ø¨Ù‡â€ŒØ±ÙˆØ²</div>
            </div>
            <div class="section-body" id="endpoints-list"></div>
          </div>
        </div>

        <div id="network" class="tab-content">
          <div class="section">
            <div class="section-header">
              <div class="section-title">ğŸŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø´Ø¨Ú©Ù‡</div>
              <div class="actions-row">
                <button class="btn btn-primary" id="network-refresh">
                  ğŸ” ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ
                </button>
                <button class="btn btn-secondary" id="network-copy">
                  ğŸ“„ Ú©Ù¾ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
                </button>
              </div>
            </div>
            <div class="section-body">
              <div class="filters">
                <div>
                  <label class="label">Ø±ÙˆØ´</label>
                  <select id="filter-method">
                    <option value="">Ù‡Ù…Ù‡</option>
                    <option>GET</option>
                    <option>POST</option>
                    <option>PUT</option>
                    <option>PATCH</option>
                    <option>DELETE</option>
                  </select>
                </div>
                <div>
                  <label class="label">ÙˆØ¶Ø¹ÛŒØª</label>
                  <select id="filter-status">
                    <option value="">Ù‡Ù…Ù‡</option>
                    <option value="ok">Ù…ÙˆÙÙ‚</option>
                    <option value="fail">Ø®Ø·Ø§</option>
                  </select>
                </div>
                <div>
                  <label class="label">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± URL</label>
                  <input class="input" id="filter-url" placeholder="/api/" />
                </div>
                <div>
                  <label class="label">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                  <input
                    class="input"
                    id="filter-minutes"
                    type="number"
                    min="0"
                    value="0"
                  />
                </div>
              </div>
              <div
                class="table-wrapper"
                style="overflow: auto; max-height: 420px"
              >
                <table aria-label="Network table">
                  <thead>
                    <tr>
                      <th data-sort="startTs">Ø²Ù…Ø§Ù†</th>
                      <th data-sort="method">Ø±ÙˆØ´</th>
                      <th data-sort="url">Ø¢Ø¯Ø±Ø³</th>
                      <th data-sort="status">ÙˆØ¶Ø¹ÛŒØª</th>
                      <th data-sort="durationMs">ØªØ§Ø®ÛŒØ± (ms)</th>
                      <th data-sort="responseSize">Ø­Ø¬Ù… Ù¾Ø§Ø³Ø®</th>
                      <th data-sort="retries">ØªÙ„Ø§Ø´</th>
                    </tr>
                  </thead>
                  <tbody id="network-body"></tbody>
                </table>
                <div class="empty-state" id="network-empty" hidden>
                  Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª
                </div>
              </div>
              <div class="drawer" id="request-detail" hidden></div>
            </div>
          </div>
        </div>

        <div id="logs" class="tab-content">
          <div class="section">
            <div class="section-header">
              <div class="section-title">ğŸ“ Ù„Ø§Ú¯ Ø³Ø§Ø®Øªâ€ŒÛŒØ§ÙØªÙ‡</div>
              <div class="actions-row">
                <button class="btn btn-primary" id="logs-copy-visible">
                  ğŸ“„ Ú©Ù¾ÛŒ Ù‚Ø§Ø¨Ù„â€ŒÙ…Ø´Ø§Ù‡Ø¯Ù‡
                </button>
                <button class="btn btn-secondary" id="logs-copy-selected">
                  ğŸ“‘ Ú©Ù¾ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
                </button>
                <button class="btn btn-success" id="logs-download-json">
                  â¬‡ï¸ JSON
                </button>
                <button class="btn btn-success" id="logs-download-csv">
                  â¬‡ï¸ CSV
                </button>
                <button class="btn btn-danger" id="logs-clear">
                  ğŸ§¹ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ
                </button>
              </div>
            </div>
            <div class="section-body">
              <div class="filters">
                <div>
                  <label class="label">Ø³Ø·Ø­ Ù„Ø§Ú¯</label>
                  <select id="filter-level">
                    <option value="">Ù‡Ù…Ù‡</option>
                    <option value="debug">Debug</option>
                    <option value="info">Info</option>
                    <option value="success">Success</option>
                    <option value="warn">Warn</option>
                    <option value="error">Error</option>
                  </select>
                </div>
                <div>
                  <label class="label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                  <input
                    class="input"
                    id="filter-category"
                    placeholder="auth / network"
                  />
                </div>
                <div>
                  <label class="label">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…ØªÙ†</label>
                  <input class="input" id="filter-text" placeholder="..." />
                </div>
                <div>
                  <label class="label">Ø§Ø² ØªØ§Ø±ÛŒØ®</label>
                  <input class="input" id="filter-from" type="datetime-local" />
                </div>
                <div>
                  <label class="label">ØªØ§ ØªØ§Ø±ÛŒØ®</label>
                  <input class="input" id="filter-to" type="datetime-local" />
                </div>
              </div>
              <div class="console" id="logs-console" aria-live="polite"></div>
            </div>
          </div>
        </div>

        <div id="cache" class="tab-content">
          <div class="section">
            <div class="section-header">
              <div class="section-title">ğŸ§¹ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø´ Ùˆ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ</div>
              <div class="actions-row">
                <button class="btn btn-primary" id="cache-refresh">
                  ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                </button>
                <button class="btn btn-warning" id="cache-safe-clear">
                  ğŸ›¡ï¸ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø§Ù…Ù†
                </button>
              </div>
            </div>
            <div class="section-body">
              <div class="metrics-grid">
                <div class="metric-card">
                  <div class="metric-header">
                    <div
                      class="metric-icon"
                      style="background: #dcfce7; color: #166534"
                    >
                      ğŸ’¾
                    </div>
                    <div class="metric-title">localStorage</div>
                  </div>
                  <div class="metric-value" id="localstorage-size">-- KB</div>
                  <div class="metric-description">Ø­Ø¬Ù… ÙØ¹Ù„ÛŒ Ùˆ Ú©Ù„ÛŒØ¯Ù‡Ø§</div>
                </div>
                <div class="metric-card">
                  <div class="metric-header">
                    <div
                      class="metric-icon"
                      style="background: #dbeafe; color: #1e40af"
                    >
                      âš¡
                    </div>
                    <div class="metric-title">sessionStorage</div>
                  </div>
                  <div class="metric-value" id="sessionstorage-size">-- KB</div>
                  <div class="metric-description">Ø­Ø¬Ù… Ùˆ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù†Ø´Ø³Øª</div>
                </div>
                <div class="metric-card">
                  <div class="metric-header">
                    <div
                      class="metric-icon"
                      style="background: #fef3c7; color: #92400e"
                    >
                      ğŸ—„ï¸
                    </div>
                    <div class="metric-title">Cache API</div>
                  </div>
                  <div class="metric-value" id="cacheapi-size">-- KB</div>
                  <div class="metric-description">ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ø­Ø¬Ù… ØªÙ‚Ø±ÛŒØ¨ÛŒ</div>
                </div>
                <div class="metric-card">
                  <div class="metric-header">
                    <div
                      class="metric-icon"
                      style="background: #f3e8ff; color: #7c3aed"
                    >
                      ğŸ“Š
                    </div>
                    <div class="metric-title">Ù…Ø¬Ù…ÙˆØ¹ Ú©Ø´</div>
                  </div>
                  <div class="metric-value" id="total-cache-size">-- KB</div>
                  <div class="metric-description">Ú©Ù„ ÙØ¶Ø§ÛŒ Ù…ØµØ±ÙÛŒ</div>
                </div>
              </div>
              <div
                class="section"
                style="box-shadow: none; border: 1px solid var(--border)"
              >
                <div class="section-header">
                  <div class="section-title">Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù</div>
                  <div class="actions-row">
                    <button class="btn btn-danger" id="cache-delete-selected">
                      ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
                    </button>
                  </div>
                </div>
                <div class="section-body" id="cache-breakdown"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="diagnostics" class="tab-content">
          <div class="section">
            <div class="section-header">
              <div class="section-title">ğŸ©º Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</div>
              <div class="actions-row">
                <button class="btn btn-primary" id="diag-run">
                  ğŸ” Ø§Ø¬Ø±Ø§ÛŒ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ
                </button>
                <button class="btn btn-secondary" id="diag-download">
                  â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯
                </button>
              </div>
            </div>
            <div class="section-body">
              <div class="drawer" id="diag-output">
                Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§ØªØŒ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal-backdrop"
      id="settings-modal"
      role="dialog"
      aria-modal="true"
      aria-label="ØªÙ†Ø¸ÛŒÙ…Ø§Øª"
    >
      <div class="modal">
        <div
          class="section-header"
          style="border: none; padding: 0 0 12px 0; background: transparent"
        >
          <div class="section-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯</div>
          <button class="btn btn-secondary" id="settings-close">Ø¨Ø³ØªÙ†</button>
        </div>
        <div class="section-body" style="padding: 0; display: grid; gap: 12px">
          <div>
            <label class="label">Ø¢Ø¯Ø±Ø³ Ù¾Ø§ÛŒÙ‡ API</label>
            <input class="input" id="setting-base-url" />
          </div>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
              gap: 12px;
            "
          >
            <div>
              <label class="label">Ø¨Ø§Ø²Ù‡ Ù¾Ø§ÛŒØ´ Ø³Ù„Ø§Ù…Øª (Ø«Ø§Ù†ÛŒÙ‡)</label>
              <input class="input" id="setting-poll" type="number" min="5" />
            </div>
            <div>
              <label class="label">Timeout Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡)</label>
              <input
                class="input"
                id="setting-timeout"
                type="number"
                min="2000"
              />
            </div>
            <div>
              <label class="label">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ GET</label>
              <select id="setting-retry" class="input">
                <option value="true">ÙØ¹Ø§Ù„</option>
                <option value="false">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
              </select>
            </div>
          </div>
          <div
            style="
              display: flex;
              flex-wrap: wrap;
              gap: 12px;
              align-items: center;
            "
          >
            <label
              ><input type="checkbox" id="setting-privacy" /> Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ
              Ø´Ø¯ÛŒØ¯</label
            >
            <label
              ><input type="checkbox" id="setting-persist-logs" /> Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯ Ø¯Ø±
              Ù…Ø±ÙˆØ±Ú¯Ø±</label
            >
          </div>
          <div class="actions-row" style="justify-content: flex-end">
            <button class="btn btn-primary" id="settings-save">Ø°Ø®ÛŒØ±Ù‡</button>
          </div>
        </div>
      </div>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <script>
      (() => {
        const config = {
          apiBaseUrl: "https://api.pardistous.ir/api",
          buildTime: "BUILD_TIME_PLACEHOLDER",
          version: "VERSION_PLACEHOLDER",
          env: "ENVIRONMENT_PLACEHOLDER",
          defaultTimeout: 15000,
          maxLogMemory: 500,
          maxVisibleLogs: 200,
          logStorageKey: "pardis-debug-logs-v2",
          logStorageLimit: 2 * 1024 * 1024,
          requestStorageKey: "pardis-debug-req-v2",
          settingsKey: "pardis-debug-settings",
          persistRequestLimit: 50,
          persistLogLimit: 500,
          maxRequestsMemory: 200,
          healthInterval: 30000,
        };

        const state = {
          logs: [],
          requests: [],
          filters: {},
          logFilters: {},
          selectedLogs: new Set(),
          charts: {},
          monitoring: true,
          privacy: true,
          healthTimer: null,
          uptimeStart: Date.now(),
          cachedDiagnostics: null,
          settings: null,
          sort: { key: "startTs", dir: "desc" },
          uptime: 0,
        };

        const formatters = {
          faTime: new Intl.DateTimeFormat("fa-IR", {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          }),
          faDateTime: new Intl.DateTimeFormat("fa-IR", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          }),
        };

        /**
         * Ø³Ø§Ø¯Ù‡ Ø³Ø§Ø² Ø­Ø°Ù Ù…Ù‚Ø§Ø¯ÛŒØ± Ø­Ø³Ø§Ø³
         */
        const redact = (value) => {
          if (!value) return value;
          if (typeof value === "string") {
            if (value.length > 6)
              return `${value.slice(0, 2)}***${value.slice(-2)}`;
            return "***";
          }
          if (Array.isArray(value)) return value.map(redact);
          if (typeof value === "object") {
            const clone = {};
            Object.keys(value).forEach((k) => {
              if (/token|auth|secret|password|cookie/i.test(k)) {
                clone[k] = "[REDACTED]";
              } else {
                clone[k] = redact(value[k]);
              }
            });
            return clone;
          }
          return value;
        };

        const storage = {
          load(key, fallback) {
            try {
              const raw = localStorage.getItem(key);
              return raw ? JSON.parse(raw) : fallback;
            } catch (e) {
              console.warn("storage load failed", e);
              return fallback;
            }
          },
          save(key, value) {
            try {
              localStorage.setItem(key, JSON.stringify(value));
              return true;
            } catch (e) {
              console.warn("storage save failed", e);
              return false;
            }
          },
        };

        const toast = (message, type = "info") => {
          const container = document.getElementById("toast-container");
          const el = document.createElement("div");
          el.className = `toast ${type}`;
          el.textContent = message;
          container.appendChild(el);
          setTimeout(() => el.remove(), 4000);
        };

        const logger = {
          log(level, category, message, meta = {}) {
            const now = new Date();
            const entry = {
              id: crypto.randomUUID(),
              tsISO: now.toISOString(),
              tsLocalFa: formatters.faDateTime.format(now),
              level,
              category,
              message,
              meta: state.privacy ? redact(meta) : meta,
            };
            state.logs.push(entry);
            if (state.logs.length > config.maxLogMemory) state.logs.shift();
            if (state.settings?.persistLogs) persistLogs();
            renderLogs();
            if (level === "error") toast(message, "error");
          },
        };

        const persistLogs = () => {
          try {
            const trimmed = state.logs.slice(-config.persistLogLimit);
            let payload = JSON.stringify(trimmed);
            while (payload.length > config.logStorageLimit && trimmed.length) {
              trimmed.shift();
              payload = JSON.stringify(trimmed);
            }
            localStorage.setItem(config.logStorageKey, payload);
          } catch (e) {
            console.warn("log persist failed", e);
          }
        };

        const loadPersistedLogs = () => {
          const logs = storage.load(config.logStorageKey, []);
          if (Array.isArray(logs))
            state.logs = logs.slice(-config.maxLogMemory);
        };

        const metrics = {
          latency(series) {
            if (!series.length) return { avg: 0, p50: 0, p95: 0 };
            const sorted = [...series].sort((a, b) => a - b);
            const avg = Math.round(
              sorted.reduce((a, b) => a + b, 0) / sorted.length
            );
            const p50 = sorted[Math.floor(sorted.length * 0.5)];
            const p95 = sorted[Math.floor(sorted.length * 0.95)];
            return { avg, p50, p95 };
          },
          rpm() {
            const now = Date.now();
            const recent = state.requests.filter(
              (r) => now - r.startTs <= 5 * 60 * 1000
            );
            return Math.round(recent.length / 5 || 0);
          },
        };

        const httpClient = {
          async request({ method = "GET", url, body, headers = {}, timeout }) {
            const controller = new AbortController();
            const timer = setTimeout(
              () => controller.abort("timeout"),
              timeout || state.settings.timeout || config.defaultTimeout
            );
            const start = Date.now();
            const id = crypto.randomUUID();
            const correlationId = crypto.randomUUID();
            const opts = {
              method,
              headers: {
                Accept: "application/json",
                "Content-Type": "application/json",
                ...headers,
              },
              signal: controller.signal,
            };
            let requestSize = 0;
            if (body) {
              opts.body =
                typeof body === "string" ? body : JSON.stringify(body);
              requestSize = opts.body.length;
            }
            const record = {
              id,
              method,
              url,
              startTs: start,
              endTs: null,
              durationMs: null,
              status: null,
              ok: false,
              responseSize: 0,
              requestSize,
              retries: 0,
              errorType: null,
              correlationId,
            };

            const doFetch = async (attempt = 0) => {
              try {
                const response = await fetch(url, opts);
                const clone = response.clone();
                let text = "";
                try {
                  text = await clone.text();
                } catch (e) {
                  text = "";
                }
                record.responseSize = text.length;
                record.status = response.status;
                record.ok = response.ok;
                return { response, body: safeParseJson(text) };
              } catch (error) {
                record.errorType = error?.name || "fetch_error";
                if (
                  method === "GET" &&
                  state.settings.retryGet &&
                  attempt < 2
                ) {
                  const delay =
                    Math.pow(2, attempt) * 500 + Math.random() * 200;
                  await wait(delay);
                  record.retries += 1;
                  return doFetch(attempt + 1);
                }
                throw error;
              }
            };

            try {
              const { response, body: parsed } = await doFetch();
              record.endTs = Date.now();
              record.durationMs = record.endTs - record.startTs;
              pushRequest(record);
              clearTimeout(timer);
              return { ok: record.ok, status: record.status, data: parsed };
            } catch (error) {
              record.endTs = Date.now();
              record.durationMs = record.endTs - record.startTs;
              record.status = 0;
              record.ok = false;
              record.errorType =
                record.errorType || error?.message || "unknown";
              pushRequest(record);
              clearTimeout(timer);
              throw error;
            }
          },
        };

        const wait = (ms) => new Promise((res) => setTimeout(res, ms));

        const safeParseJson = (text) => {
          try {
            return JSON.parse(text);
          } catch (e) {
            return text;
          }
        };

        const pushRequest = (req) => {
          state.requests.push(req);
          if (state.requests.length > config.maxRequestsMemory)
            state.requests.shift();
          persistRequests();
          updateStatus(req);
          renderNetwork();
          updateCharts();
          logger.log(
            req.ok ? "success" : "error",
            "network",
            `${req.method} ${req.url} ${req.status || "ERR"}`,
            {
              durationMs: req.durationMs,
              status: req.status,
              retries: req.retries,
            }
          );
        };

        const persistRequests = () => {
          try {
            const trimmed = state.requests.slice(-config.persistRequestLimit);
            storage.save(config.requestStorageKey, trimmed);
          } catch (e) {
            console.warn("request persist fail", e);
          }
        };

        const loadRequests = () => {
          const reqs = storage.load(config.requestStorageKey, []);
          if (Array.isArray(reqs))
            state.requests = reqs.slice(-config.maxRequestsMemory);
        };

        const ui = {
          bindTabs() {
            document.querySelectorAll(".tab").forEach((tab) => {
              tab.addEventListener("click", () =>
                ui.switchTab(tab.dataset.tab, tab)
              );
            });
          },
          switchTab(name, tabEl) {
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));
            document.getElementById(name).classList.add("active");
            document
              .querySelectorAll(".tab")
              .forEach((t) => t.classList.remove("active"));
            if (tabEl) tabEl.classList.add("active");
            logger.log("info", "ui", `ØªØºÛŒÛŒØ± ØªØ¨ Ø¨Ù‡ ${name}`);
          },
        };

        const renderLogs = () => {
          const container = document.getElementById("logs-console");
          if (!container) return;
          const filters = state.logFilters;
          let entries = [...state.logs];
          if (filters.level)
            entries = entries.filter((l) => l.level === filters.level);
          if (filters.category)
            entries = entries.filter((l) =>
              l.category.toLowerCase().includes(filters.category.toLowerCase())
            );
          if (filters.text)
            entries = entries.filter((l) =>
              (l.message + JSON.stringify(l.meta || {}))
                .toLowerCase()
                .includes(filters.text.toLowerCase())
            );
          if (filters.from)
            entries = entries.filter(
              (l) => new Date(l.tsISO) >= new Date(filters.from)
            );
          if (filters.to)
            entries = entries.filter(
              (l) => new Date(l.tsISO) <= new Date(filters.to)
            );
          entries = entries.slice(-config.maxVisibleLogs).reverse();
          container.innerHTML = "";
          if (!entries.length) {
            container.innerHTML =
              '<div class="empty-state">Ù„Ø§Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†ÛŒØ³Øª</div>';
            return;
          }
          entries.forEach((log) => {
            const row = document.createElement("div");
            row.className = "log-entry";
            row.innerHTML = `
              <div class="log-time">${log.tsLocalFa}</div>
              <div class="log-level ${
                log.level
              }">${log.level.toUpperCase()}</div>
              <div class="message"><strong>${log.category}:</strong> ${
              log.message
            }</div>
              <div style="display:flex;align-items:center;gap:8px;justify-content:flex-end;">
                <input type="checkbox" data-log-id="${log.id}" ${
              state.selectedLogs.has(log.id) ? "checked" : ""
            } />
              </div>
              <div style="grid-column:1 / -1;color:#9ca3af;font-size:0.85rem;">${
                log.meta ? JSON.stringify(log.meta) : ""
              }</div>
            `;
            container.appendChild(row);
          });
          container.querySelectorAll("input[type='checkbox']").forEach((cb) => {
            cb.addEventListener("change", (e) => {
              const id = e.target.dataset.logId;
              if (e.target.checked) state.selectedLogs.add(id);
              else state.selectedLogs.delete(id);
            });
          });
        };

        const renderNetwork = () => {
          const tbody = document.getElementById("network-body");
          const empty = document.getElementById("network-empty");
          if (!tbody) return;
          const filterMethod = document.getElementById("filter-method").value;
          const filterStatus = document.getElementById("filter-status").value;
          const filterUrl = document
            .getElementById("filter-url")
            .value.toLowerCase();
          const filterMinutes = parseInt(
            document.getElementById("filter-minutes").value || "0",
            10
          );
          const now = Date.now();
          let rows = [...state.requests];
          if (filterMethod)
            rows = rows.filter((r) => r.method === filterMethod);
          if (filterStatus)
            rows = rows.filter((r) => (filterStatus === "ok" ? r.ok : !r.ok));
          if (filterUrl)
            rows = rows.filter((r) => r.url.toLowerCase().includes(filterUrl));
          if (filterMinutes > 0)
            rows = rows.filter(
              (r) => now - r.startTs <= filterMinutes * 60 * 1000
            );
          const { key, dir } = state.sort;
          rows.sort((a, b) => {
            const valA = a[key] ?? 0;
            const valB = b[key] ?? 0;
            return dir === "asc" ? valA - valB : valB - valA;
          });
          tbody.innerHTML = "";
          if (!rows.length) {
            empty.hidden = false;
            return;
          }
          empty.hidden = true;
          rows
            .slice(-200)
            .reverse()
            .forEach((req) => {
              const tr = document.createElement("tr");
              tr.dataset.reqId = req.id;
              tr.innerHTML = `
              <td>${formatters.faTime.format(new Date(req.startTs))}</td>
              <td><span class="badge ${
                req.method === "GET" ? "info" : "warning"
              }">${req.method}</span></td>
              <td style="max-width:320px;word-break:break-all;">${req.url}</td>
              <td>${
                req.ok
                  ? '<span class="badge success">Ù…ÙˆÙÙ‚</span>'
                  : `<span class="badge error">${req.status || "Ø®Ø·Ø§"}</span>`
              }</td>
              <td>${req.durationMs || 0}</td>
              <td>${req.responseSize || 0} B</td>
              <td>${req.retries}</td>
            `;
              tr.addEventListener("click", () => showRequestDetail(req));
              tbody.appendChild(tr);
            });
        };

        const showRequestDetail = (req) => {
          const detail = document.getElementById("request-detail");
          if (!detail) return;
          detail.hidden = false;
          detail.innerHTML = `
            <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;">
              <div><div class="label">Ø´Ù†Ø§Ø³Ù‡</div><div class="value">${
                req.id
              }</div></div>
              <div><div class="label">Correlation</div><div class="value">${
                req.correlationId
              }</div></div>
              <div><div class="label">Ù…Ø¯Øª</div><div class="value">${
                req.durationMs
              } ms</div></div>
              <div><div class="label">ÙˆØ¶Ø¹ÛŒØª</div><div class="value">${
                req.status || "-"
              }</div></div>
            </div>
            <div style="margin-top:12px;display:grid;gap:8px;">
              <div class="label">URL</div>
              <div class="value" style="word-break:break-all;">${req.url}</div>
              <div class="label">ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´</div>
              <div class="value">${req.retries}</div>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
              <button class="btn btn-secondary" id="copy-curl">ğŸ“‹ Ú©Ù¾ÛŒ Curl</button>
            </div>
          `;
          const copyBtn = detail.querySelector("#copy-curl");
          if (copyBtn) copyBtn.addEventListener("click", () => copyCurl(req));
        };

        const copyCurl = (req) => {
          const url = req.url.startsWith("http")
            ? req.url
            : `${state.settings.baseUrl}${req.url}`;
          const safeHeaders = redactHeaders({
            Authorization: localStorage.getItem("token"),
            Accept: "application/json",
          });
          const headerString = Object.entries(safeHeaders)
            .filter(([, v]) => v)
            .map(([k, v]) => `-H "${k}: ${v}"`)
            .join(" ");
          const cmd = `curl -X ${
            req.method
          } ${headerString} --max-time ${Math.round(
            (state.settings.timeout || config.defaultTimeout) / 1000
          )} "${url}"`;
          navigator.clipboard
            .writeText(cmd)
            .then(() => toast("Ø¯Ø³ØªÙˆØ± curl Ú©Ù¾ÛŒ Ø´Ø¯", "success"));
        };

        const redactHeaders = (headers = {}) => {
          const clone = {};
          Object.entries(headers).forEach(([k, v]) => {
            if (!v) return;
            if (/authorization|token|cookie/i.test(k)) clone[k] = "[REDACTED]";
            else clone[k] = v;
          });
          return clone;
        };

        const updateStatus = (req) => {
          const lastUpdate = formatters.faTime.format(new Date());
          document.getElementById("last-update").textContent = lastUpdate;
          const avg = metrics.latency(
            state.requests.map((r) => r.durationMs || 0)
          ).avg;
          document.getElementById("response-time").textContent = `${
            avg || 0
          } ms`;
          document.getElementById("request-count").textContent =
            state.requests.length;
          const successRate = state.requests.length
            ? Math.round(
                (state.requests.filter((r) => r.ok).length /
                  state.requests.length) *
                  100
              )
            : 100;
          document.getElementById(
            "health-score"
          ).textContent = `${successRate}%`;
          document.getElementById(
            "request-rate"
          ).textContent = `${metrics.rpm()} req/min`;
          document.getElementById("avg-response").textContent = `${
            avg || 0
          } ms`;
          document.getElementById("status-dot").style.background =
            successRate < 70 ? "var(--error)" : "var(--success)";
        };

        const updateCharts = () => {
          const latencyCtx = document.getElementById("latency-chart");
          const rpmCtx = document.getElementById("rpm-chart");
          const statusCtx = document.getElementById("status-chart");
          if (!latencyCtx) return;
          const labels = state.requests
            .slice(-50)
            .map((r) => formatters.faTime.format(new Date(r.startTs)));
          const latencies = state.requests
            .slice(-50)
            .map((r) => r.durationMs || 0);
          const statusData = state.requests.slice(-200).reduce((acc, r) => {
            const group = r.status || "0";
            acc[group] = (acc[group] || 0) + 1;
            return acc;
          }, {});
          const rpmData = [];
          for (let i = 5; i >= 0; i--) {
            const from = Date.now() - i * 60 * 1000;
            const to = from + 60 * 1000;
            const count = state.requests.filter(
              (r) => r.startTs >= from && r.startTs < to
            ).length;
            rpmData.push(count);
          }
          if (!state.charts.latency) {
            state.charts.latency = new Chart(latencyCtx, {
              type: "line",
              data: {
                labels,
                datasets: [
                  {
                    label: "ØªØ§Ø®ÛŒØ± (ms)",
                    data: latencies,
                    borderColor: "#4f46e5",
                    fill: false,
                  },
                ],
              },
              options: {
                animation: false,
                responsive: true,
                plugins: { legend: { display: false } },
              },
            });
          } else {
            state.charts.latency.data.labels = labels;
            state.charts.latency.data.datasets[0].data = latencies;
            state.charts.latency.update();
          }
          if (!state.charts.status) {
            state.charts.status = new Chart(statusCtx, {
              type: "doughnut",
              data: {
                labels: Object.keys(statusData),
                datasets: [
                  {
                    data: Object.values(statusData),
                    backgroundColor: [
                      "#10b981",
                      "#ef4444",
                      "#f59e0b",
                      "#3b82f6",
                    ],
                  },
                ],
              },
              options: { animation: false },
            });
          } else {
            state.charts.status.data.labels = Object.keys(statusData);
            state.charts.status.data.datasets[0].data =
              Object.values(statusData);
            state.charts.status.update();
          }
          if (!state.charts.rpm) {
            state.charts.rpm = new Chart(rpmCtx, {
              type: "bar",
              data: {
                labels: ["-5", "-4", "-3", "-2", "-1", "Ø§Ù„Ø§Ù†"],
                datasets: [
                  {
                    label: "Ø¯Ø±Ø®ÙˆØ§Ø³Øª/Ø¯Ù‚ÛŒÙ‚Ù‡",
                    data: rpmData,
                    backgroundColor: "#7c3aed",
                  },
                ],
              },
              options: {
                animation: false,
                plugins: { legend: { display: false } },
              },
            });
          } else {
            state.charts.rpm.data.datasets[0].data = rpmData;
            state.charts.rpm.update();
          }
        };

        const runHealthCheck = async () => {
          const loader = document.getElementById("health-loading");
          loader.hidden = false;
          try {
            const res = await httpClient.request({
              method: "GET",
              url: `${state.settings.baseUrl}/Health`,
            });
            logger.log(
              res.ok ? "success" : "warn",
              "health",
              "Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª",
              res.data || {}
            );
            toast(
              res.ok ? "API Ø³Ø§Ù„Ù… Ø§Ø³Øª" : "API Ø¯Ø§Ø±Ø§ÛŒ Ù…Ø´Ú©Ù„ Ø§Ø³Øª",
              res.ok ? "success" : "error"
            );
          } catch (e) {
            logger.log("error", "health", "Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª", {
              error: e.message,
            });
          } finally {
            loader.hidden = true;
          }
        };

        const startHealthPolling = () => {
          if (state.healthTimer) clearInterval(state.healthTimer);
          const interval = state.settings.pollInterval || config.healthInterval;
          state.healthTimer = setInterval(() => {
            if (!state.monitoring) return;
            runHealthCheck();
          }, interval + Math.random() * 5000);
        };

        const testEndpoints = async () => {
          const loader = document.getElementById("test-loading");
          loader.hidden = false;
          for (const ep of endpoints) {
            try {
              const res = await httpClient.request({
                method: ep.method,
                url: `${state.settings.baseUrl}${ep.url}`,
              });
              logger.log(
                res.ok ? "success" : "error",
                "endpoint",
                `${ep.name} (${ep.method})`,
                res.data || {}
              );
            } catch (e) {
              logger.log("error", "endpoint", `${ep.name} Ø®Ø·Ø§`, {
                error: e.message,
              });
            }
          }
          loader.hidden = true;
        };

        const endpoints = [
          {
            name: "Health Check",
            method: "GET",
            url: "/Health",
            description: "Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ù„Ø§Ù…Øª API",
            category: "System",
          },
          {
            name: "Get Active Hero Slides",
            method: "GET",
            url: "/HeroSlides/active",
            description: "Ø¯Ø±ÛŒØ§ÙØª Ø§Ø³Ù„Ø§ÛŒØ¯Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ",
            category: "Content",
          },
          {
            name: "Get All Hero Slides",
            method: "GET",
            url: "/HeroSlides",
            description: "Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ù… Ø§Ø³Ù„Ø§ÛŒØ¯Ù‡Ø§ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ",
            category: "Content",
          },
          {
            name: "Get Active Success Stories",
            method: "GET",
            url: "/SuccessStories/active",
            description: "Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª ÙØ¹Ø§Ù„",
            category: "Content",
          },
          {
            name: "Get Success Stories by Type",
            method: "GET",
            url: "/SuccessStories/type/{type}",
            description: "Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹",
            category: "Content",
          },
          {
            name: "Get All Success Stories",
            method: "GET",
            url: "/SuccessStories",
            description: "Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ù… Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª",
            category: "Content",
          },
          {
            name: "Get Courses",
            method: "GET",
            url: "/Courses",
            description: "Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§",
            category: "Education",
          },
          {
            name: "Get Categories",
            method: "GET",
            url: "/Categories",
            description: "Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§",
            category: "Education",
          },
          {
            name: "User Profile",
            method: "GET",
            url: "/Auth/me",
            description: "Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±",
            category: "Authentication",
            requiresAuth: true,
          },
          {
            name: "Login",
            method: "POST",
            url: "/Auth/login",
            description: "ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…",
            category: "Authentication",
          },
          {
            name: "Get Instructors",
            method: "GET",
            url: "/Instructors",
            description: "Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ù…Ø¯Ø±Ø³Ø§Ù†",
            category: "Education",
          },
        ];

        const renderEndpoints = () => {
          const container = document.getElementById("endpoints-list");
          container.innerHTML = "";
          const categories = [...new Set(endpoints.map((e) => e.category))];
          categories.forEach((cat) => {
            const block = document.createElement("div");
            block.innerHTML = `<h3 style="margin:18px 0;color:var(--primary);">ğŸ“ ${cat}</h3>`;
            endpoints
              .filter((e) => e.category === cat)
              .forEach((ep) => {
                const card = document.createElement("div");
                card.className = "section";
                card.style.marginBottom = "12px";
                card.innerHTML = `
                  <div class="section-header" style="padding:14px 16px;">
                    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                      <span class="badge ${
                        ep.method === "GET"
                          ? "info"
                          : ep.method === "POST"
                          ? "success"
                          : "warning"
                      }">${ep.method}</span>
                      <span class="value" style="font-family:monospace;">${
                        ep.url
                      }</span>
                      ${
                        ep.requiresAuth
                          ? '<span class="badge warning">ğŸ” Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</span>'
                          : ""
                      }
                    </div>
                    <button class="btn btn-primary" data-test-endpoint="${
                      ep.url
                    }" data-method="${ep.method}">ğŸ§ª ØªØ³Øª</button>
                  </div>
                  <div class="section-body" style="padding:12px 16px;">${
                    ep.description
                  }</div>
                `;
                block.appendChild(card);
              });
            container.appendChild(block);
          });
          container.querySelectorAll("[data-test-endpoint]").forEach((btn) => {
            btn.addEventListener("click", async () => {
              const url = btn.dataset.testEndpoint;
              const method = btn.dataset.method;
              logger.log("info", "endpoint", `ØªØ³Øª ${method} ${url}`);
              try {
                const res = await httpClient.request({
                  method,
                  url: `${state.settings.baseUrl}${url}`,
                });
                logger.log(
                  res.ok ? "success" : "error",
                  "endpoint",
                  `${url} Ù†ØªÛŒØ¬Ù‡`,
                  res.data || {}
                );
              } catch (e) {
                logger.log("error", "endpoint", `${url} Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯`, {
                  error: e.message,
                });
              }
            });
          });
        };

        const handleLogFilters = () => {
          state.logFilters = {
            level: document.getElementById("filter-level").value,
            category: document.getElementById("filter-category").value,
            text: document.getElementById("filter-text").value,
            from: document.getElementById("filter-from").value,
            to: document.getElementById("filter-to").value,
          };
          renderLogs();
        };

        const copyLogs = (entries) => {
          const payload = JSON.stringify(entries, null, 2);
          navigator.clipboard
            .writeText(payload)
            .then(() => toast("Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ú©Ù¾ÛŒ Ø´Ø¯Ù†Ø¯", "success"));
        };

        const download = (entries, type) => {
          if (state.privacy && !confirm("Ø¯Ø± Ø­Ø§Ù„Øª Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ Ù‡Ø³ØªÛŒØ¯. Ø§Ø¯Ø§Ù…Ù‡ØŸ"))
            return;
          let blob;
          if (type === "json") {
            blob = new Blob([JSON.stringify(entries, null, 2)], {
              type: "application/json",
            });
          } else {
            const csv = ["tsISO,level,category,message"].concat(
              entries.map(
                (l) =>
                  `${l.tsISO},${l.level},${l.category},"${(
                    l.message || ""
                  ).replace(/"/g, '""')}"`
              )
            );
            blob = new Blob([csv.join("\n")], { type: "text/csv" });
          }
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `logs-${Date.now()}.${type}`;
          a.click();
          URL.revokeObjectURL(url);
        };

        const shareBundle = async () => {
          const diag = await collectDiagnostics();
          const bundle = {
            createdAt: new Date().toISOString(),
            environment: {
              baseUrl: state.settings.baseUrl,
              version: config.version,
              env: config.env,
            },
            logs: state.logs.slice(-config.maxVisibleLogs),
            diagnostics: diag,
            requests: state.requests.slice(-50),
          };
          copyLogs(bundle);
        };

        const collectDiagnostics = async () => {
          const info = {
            userAgent: navigator.userAgent,
            language: navigator.language,
            platform: navigator.platform,
            online: navigator.onLine,
            connection: navigator.connection
              ? {
                  effectiveType: navigator.connection.effectiveType,
                  downlink: navigator.connection.downlink,
                }
              : "n/a",
            memory: performance.memory
              ? {
                  jsHeapSizeLimit: performance.memory.jsHeapSizeLimit,
                  totalJSHeapSize: performance.memory.totalJSHeapSize,
                  usedJSHeapSize: performance.memory.usedJSHeapSize,
                }
              : "n/a",
            navigationTiming: performance
              .getEntriesByType("navigation")
              .map((e) => ({
                type: e.type,
                startTime: e.startTime,
                duration: e.duration,
              })),
            resourceSummary: summarizeResources(),
            storage: await storageUsage(),
            serviceWorker: await swInfo(),
          };
          state.cachedDiagnostics = info;
          return info;
        };

        const summarizeResources = () => {
          const entries = performance.getEntriesByType("resource");
          const total = entries.reduce(
            (acc, e) => acc + (e.transferSize || 0),
            0
          );
          return { count: entries.length, transferSize: total };
        };

        const storageUsage = async () => {
          const lsSize = calcStorageSize(localStorage);
          const ssSize = calcStorageSize(sessionStorage);
          const cachesInfo = await cacheInfo();
          return {
            localStorage: lsSize,
            sessionStorage: ssSize,
            caches: cachesInfo,
          };
        };

        const swInfo = async () => {
          try {
            const registrations =
              (await navigator.serviceWorker?.getRegistrations?.()) || [];
            return {
              registered: registrations.length,
              scopes: registrations.map((r) => r.scope),
            };
          } catch (e) {
            return { registered: 0 };
          }
        };

        const cacheInfo = async () => {
          if (!("caches" in window)) return { supported: false, caches: [] };
          const names = await caches.keys();
          const result = [];
          for (const name of names) {
            const cache = await caches.open(name);
            const requests = await cache.keys();
            let size = 0;
            for (const req of requests.slice(0, 20)) {
              const res = await cache.match(req);
              if (res) {
                const clone = res.clone();
                const blob = await clone.blob();
                size += blob.size;
              }
            }
            result.push({ name, entries: requests.length, size });
          }
          return { supported: true, caches: result };
        };

        const calcStorageSize = (storageObj) => {
          let total = 0;
          const keys = [];
          for (const key in storageObj) {
            if (!Object.prototype.hasOwnProperty.call(storageObj, key))
              continue;
            const value = storageObj.getItem(key) || "";
            total += key.length + value.length;
            keys.push({ key, size: key.length + value.length });
          }
          return { bytes: total, keys };
        };

        const renderCache = async () => {
          const ls = calcStorageSize(localStorage);
          const ss = calcStorageSize(sessionStorage);
          const cacheApi = await cacheInfo();
          const cacheSize =
            cacheApi.caches?.reduce((acc, c) => acc + c.size, 0) || 0;
          document.getElementById("localstorage-size").textContent = `${(
            ls.bytes / 1024
          ).toFixed(2)} KB`;
          document.getElementById("sessionstorage-size").textContent = `${(
            ss.bytes / 1024
          ).toFixed(2)} KB`;
          document.getElementById("cacheapi-size").textContent = `${(
            cacheSize / 1024
          ).toFixed(2)} KB`;
          document.getElementById("total-cache-size").textContent = `${(
            (ls.bytes + ss.bytes + cacheSize) /
            1024
          ).toFixed(2)} KB`;
          document.getElementById("cache-size-display").textContent = `${(
            (ls.bytes + ss.bytes + cacheSize) /
            1024
          ).toFixed(2)} KB`;
          const container = document.getElementById("cache-breakdown");
          container.innerHTML = "";
          const section = document.createElement("div");
          section.innerHTML = "<h4>localStorage</h4>";
          ls.keys.forEach((k) => {
            const row = document.createElement("div");
            row.innerHTML = `<label><input type="checkbox" data-ls="${
              k.key
            }" /> ${k.key} (${(k.size / 1024).toFixed(2)} KB)</label>`;
            section.appendChild(row);
          });
          const section2 = document.createElement("div");
          section2.innerHTML =
            "<h4 style='margin-top:12px'>sessionStorage</h4>";
          ss.keys.forEach((k) => {
            const row = document.createElement("div");
            row.innerHTML = `<label><input type="checkbox" data-ss="${
              k.key
            }" /> ${k.key} (${(k.size / 1024).toFixed(2)} KB)</label>`;
            section2.appendChild(row);
          });
          const section3 = document.createElement("div");
          section3.innerHTML = "<h4 style='margin-top:12px'>Cache API</h4>";
          cacheApi.caches?.forEach((c) => {
            const row = document.createElement("div");
            row.innerHTML = `<label><input type="checkbox" data-cache="${
              c.name
            }" /> ${c.name} (${(c.size / 1024).toFixed(2)} KB / ${
              c.entries
            } Ù…ÙˆØ±Ø¯)</label>`;
            section3.appendChild(row);
          });
          container.append(section, section2, section3);
        };

        const clearSelectedCache = async () => {
          const lsToDelete = [
            ...document.querySelectorAll("[data-ls]:checked"),
          ].map((el) => el.dataset.ls);
          const ssToDelete = [
            ...document.querySelectorAll("[data-ss]:checked"),
          ].map((el) => el.dataset.ss);
          const cachesToDelete = [
            ...document.querySelectorAll("[data-cache]:checked"),
          ].map((el) => el.dataset.cache);
          lsToDelete.forEach((k) => localStorage.removeItem(k));
          ssToDelete.forEach((k) => sessionStorage.removeItem(k));
          for (const name of cachesToDelete) await caches.delete(name);
          toast("Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯", "success");
          renderCache();
        };

        const safeClear = async () => {
          const token = localStorage.getItem("token");
          if (!confirm("Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø­ÙØ¸ ØªÙˆÚ©Ù† Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯ØŸ")) return;
          localStorage.clear();
          sessionStorage.clear();
          if (token) localStorage.setItem("token", token);
          const names = await caches.keys();
          await Promise.all(names.map((n) => caches.delete(n)));
          toast("Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø§Ù…Ù† Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯", "success");
          renderCache();
        };

        const diagnosticsUI = async () => {
          const out = document.getElementById("diag-output");
          out.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ...";
          const info = await collectDiagnostics();
          out.textContent = JSON.stringify(info, null, 2);
        };

        const downloadDiagnostics = async () => {
          const info = state.cachedDiagnostics || (await collectDiagnostics());
          const blob = new Blob([JSON.stringify(info, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `diagnostics-${Date.now()}.json`;
          a.click();
          URL.revokeObjectURL(url);
        };

        const setupSettings = () => {
          const defaults = {
            baseUrl: config.apiBaseUrl,
            pollInterval: config.healthInterval,
            timeout: config.defaultTimeout,
            retryGet: true,
            privacy: true,
            persistLogs: true,
          };
          state.settings = {
            ...defaults,
            ...storage.load(config.settingsKey, {}),
          };
          state.privacy = state.settings.privacy;
          document.getElementById("setting-base-url").value =
            state.settings.baseUrl;
          document.getElementById("setting-poll").value = Math.round(
            state.settings.pollInterval / 1000
          );
          document.getElementById("setting-timeout").value =
            state.settings.timeout;
          document.getElementById("setting-retry").value =
            state.settings.retryGet;
          document.getElementById("setting-privacy").checked =
            state.settings.privacy;
          document.getElementById("setting-persist-logs").checked =
            state.settings.persistLogs;
          document.getElementById("privacy-badge").textContent = state.settings
            .privacy
            ? "Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ ÙØ¹Ø§Ù„"
            : "Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ Ø¹Ø§Ø¯ÛŒ";
        };

        const saveSettings = () => {
          state.settings = {
            baseUrl:
              document.getElementById("setting-base-url").value ||
              config.apiBaseUrl,
            pollInterval:
              Number(document.getElementById("setting-poll").value) * 1000 ||
              config.healthInterval,
            timeout:
              Number(document.getElementById("setting-timeout").value) ||
              config.defaultTimeout,
            retryGet: document.getElementById("setting-retry").value === "true",
            privacy: document.getElementById("setting-privacy").checked,
            persistLogs: document.getElementById("setting-persist-logs")
              .checked,
          };
          state.privacy = state.settings.privacy;
          storage.save(config.settingsKey, state.settings);
          document.getElementById("settings-modal").style.display = "none";
          document.getElementById("privacy-badge").textContent = state.settings
            .privacy
            ? "Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ ÙØ¹Ø§Ù„"
            : "Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ Ø¹Ø§Ø¯ÛŒ";
          toast("ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯", "success");
          startHealthPolling();
        };

        const exportSelectedLogs = (type) => {
          const entries = state.logs.filter((l) =>
            state.selectedLogs.has(l.id)
          );
          if (!entries.length) return toast("Ù„Ø§Ú¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª", "error");
          download(entries, type);
        };

        const exportVisibleLogs = (type) => {
          const container = document.getElementById("logs-console");
          const ids = [...container.querySelectorAll("input[data-log-id]")].map(
            (cb) => cb.dataset.logId
          );
          const entries = state.logs.filter((l) => ids.includes(l.id));
          download(entries, type);
        };

        const clearLogs = () => {
          state.logs = [];
          state.selectedLogs.clear();
          localStorage.removeItem(config.logStorageKey);
          renderLogs();
          toast("Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯", "info");
        };

        const toggleMonitoring = () => {
          state.monitoring = !state.monitoring;
          document.getElementById("action-pause-health").textContent =
            state.monitoring ? "â¸ï¸ ØªÙˆÙ‚Ù Ù¾Ø§ÛŒØ´" : "â–¶ï¸ Ø§Ø¯Ø§Ù…Ù‡ Ù¾Ø§ÛŒØ´";
        };

        const bindEvents = () => {
          document
            .getElementById("action-health")
            .addEventListener("click", runHealthCheck);
          document
            .getElementById("action-test-all")
            .addEventListener("click", testEndpoints);
          document
            .getElementById("action-export-bundle")
            .addEventListener("click", shareBundle);
          document
            .getElementById("action-pause-health")
            .addEventListener("click", toggleMonitoring);
          document
            .getElementById("network-refresh")
            .addEventListener("click", renderNetwork);
          document
            .getElementById("network-copy")
            .addEventListener("click", () => {
              const detail = document.getElementById("request-detail");
              const id = detail?.querySelector(".value")?.textContent;
              const req = state.requests.find((r) => r.id === id);
              if (req) copyCurl(req);
            });
          document
            .getElementById("logs-copy-visible")
            .addEventListener("click", () =>
              copyLogs(state.logs.slice(-config.maxVisibleLogs))
            );
          document
            .getElementById("logs-copy-selected")
            .addEventListener("click", () =>
              copyLogs(state.logs.filter((l) => state.selectedLogs.has(l.id)))
            );
          document
            .getElementById("logs-download-json")
            .addEventListener("click", () => exportVisibleLogs("json"));
          document
            .getElementById("logs-download-csv")
            .addEventListener("click", () => exportVisibleLogs("csv"));
          document
            .getElementById("logs-clear")
            .addEventListener("click", clearLogs);
          [
            "filter-level",
            "filter-category",
            "filter-text",
            "filter-from",
            "filter-to",
          ].forEach((id) => {
            document
              .getElementById(id)
              .addEventListener("input", handleLogFilters);
          });
          [
            "filter-method",
            "filter-status",
            "filter-url",
            "filter-minutes",
          ].forEach((id) => {
            document
              .getElementById(id)
              .addEventListener("input", renderNetwork);
          });
          document.querySelectorAll("th[data-sort]").forEach((th) => {
            th.addEventListener("click", () => {
              const key = th.dataset.sort;
              if (state.sort.key === key)
                state.sort.dir = state.sort.dir === "asc" ? "desc" : "asc";
              else state.sort = { key, dir: "desc" };
              renderNetwork();
            });
          });
          document
            .getElementById("cache-refresh")
            .addEventListener("click", renderCache);
          document
            .getElementById("cache-delete-selected")
            .addEventListener("click", clearSelectedCache);
          document
            .getElementById("cache-safe-clear")
            .addEventListener("click", safeClear);
          document
            .getElementById("diag-run")
            .addEventListener("click", diagnosticsUI);
          document
            .getElementById("diag-download")
            .addEventListener("click", downloadDiagnostics);
          document
            .getElementById("open-settings")
            .addEventListener(
              "click",
              () =>
                (document.getElementById("settings-modal").style.display =
                  "flex")
            );
          document
            .getElementById("settings-close")
            .addEventListener(
              "click",
              () =>
                (document.getElementById("settings-modal").style.display =
                  "none")
            );
          document
            .getElementById("settings-save")
            .addEventListener("click", saveSettings);
          document
            .getElementById("setting-privacy")
            .addEventListener(
              "change",
              (e) => (state.privacy = e.target.checked)
            );
        };

        const bootstrap = () => {
          setupSettings();
          loadPersistedLogs();
          loadRequests();
          ui.bindTabs();
          bindEvents();
          renderLogs();
          renderNetwork();
          renderEndpoints();
          renderCache();
          updateCharts();
          startHealthPolling();
          runHealthCheck();
          logger.log("info", "init", "Ú©Ù†Ø³ÙˆÙ„ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª", {
            version: config.version,
            env: config.env,
          });
        };

        document.addEventListener("DOMContentLoaded", bootstrap);
      })();
    </script>
  </body>
</html>
